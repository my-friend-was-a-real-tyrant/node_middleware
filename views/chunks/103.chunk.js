webpackJsonp([103],{1085:function(e,t){},1269:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contain-main"},[e._m(0),e._v(" "),a("el-form",{ref:"formData",staticClass:"scoped-form",attrs:{rules:e.formRules,model:e.formData,"label-width":"100px","label-position":"left"}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"编号："}},[a("span",[e._v(e._s(e.info.number))])])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"报修类型"}},[a("span",[e._v(e._s(e.info.repairmentType))])])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"状态"}},[a("span",[e._v(e._s(e.info.repairmentStatus))])])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"联系人"}},[a("span",[e._v(e._s(e.info.contactPerson))])])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"联系方式"}},[a("span",[e._v(e._s(e.info.contactPersonCellphone))])])],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"报修时间"}},[a("span",[e._v(e._s(e.info.repairmentDatetime))])])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"报修区域"}},[a("span",[e._v(e._s(e.info.repairmentArea))])])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"报修内容"}},[a("pre",[e._v(e._s(e.info.description))])])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"最佳上门时间"}},[a("span",[e._v(e._s(e.info.bestTime))])])],1)],1),e._v(" "),""!==e.info.repairMan?a("el-form-item",{attrs:{label:"维修人"}},[a("span",[e._v(e._s(e.info.repairMan))])]):e._e(),e._v(" "),""!==e.info.repairManCellphone?a("el-form-item",{attrs:{label:"联系方式"}},[a("span",[e._v(e._s(e.info.repairManCellphone))])]):e._e(),e._v(" "),""!==e.info.assess?a("el-form-item",{attrs:{label:"评价"}},[a("span",[e._v(e._s(e.info.assess))])]):e._e(),e._v(" "),0!==e.info.repairmentImgList.length?a("el-form-item",{attrs:{label:"报修图片"}},e._l(e.info.repairmentImgList,function(t){return a("img",{key:t,staticClass:"repairmentInfo-img",attrs:{src:t},on:{click:function(a){e.handleBigImage(t)}}})})):e._e(),e._v(" "),0!==e.info.manageImgList.length?a("el-form-item",{attrs:{label:"转送图片"}},e._l(e.info.manageImgList,function(t){return a("img",{key:t,staticClass:"repairmentInfo-img",attrs:{src:t},on:{click:function(a){e.handleBigImage(t)}}})})):e._e(),e._v(" "),0!==e.info.completeImgList.length?a("el-form-item",{attrs:{label:"完成图片"}},e._l(e.info.completeImgList,function(t){return a("img",{key:t,staticClass:"repairmentInfo-img",attrs:{src:t},on:{click:function(a){e.handleBigImage(t)}}})})):e._e(),e._v(" "),"审核中"===e.info.repairmentStatus?a("el-form-item",{directives:[{name:"permit",rawName:"v-permit",value:1102,expression:"1102"}],attrs:{label:"审批",prop:"chooseApproveType"}},[a("el-select",{attrs:{placeholder:"请选择审批方式"},model:{value:e.formData.chooseApproveType,callback:function(t){e.formData.chooseApproveType=t},expression:"formData.chooseApproveType"}},e._l(e.approveType,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1):e._e(),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:2===e.formData.chooseApproveType,expression:"formData.chooseApproveType === 2"},{name:"permit",rawName:"v-permit",value:1102,expression:"1102"}],attrs:{label:"维修员",prop:"repairMan"}},[a("el-select",{model:{value:e.formData.repairMan,callback:function(t){e.formData.repairMan=t},expression:"formData.repairMan"}},e._l(e.repairManList,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}))],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"维修中"===e.info.repairmentStatus||"已转送"===e.info.repairmentStatus||"审核中"===e.info.repairmentStatus&&""!==e.formData.chooseApproveType,expression:"(info.repairmentStatus === '维修中' || info.repairmentStatus === '已转送') || (info.repairmentStatus === '审核中' && formData.chooseApproveType !== '')"},{name:"permit",rawName:"v-permit",value:1102,expression:"1102"}],attrs:{label:"备注",prop:"remark"}},[a("el-input",{model:{value:e.formData.remark,callback:function(t){e.formData.remark=t},expression:"formData.remark"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"维修中"===e.info.repairmentStatus,expression:"(info.repairmentStatus === '维修中')"},{name:"permit",rawName:"v-permit",value:1102,expression:"1102"}],attrs:{label:"完成图片",prop:"reportImgListComplete"}},[a("el-upload",{ref:"complete",attrs:{action:"/v1/file","list-type":"picture-card",name:"file",accept:"image/*",data:{uploadType:2,fileSuffixType:1},"on-success":e.handleReportImgUpload,"on-preview":e.handlePictureCardPreview,"on-change":e.handleReportImgChangeComplete,"on-remove":e.handleReportImgChangeComplete,"before-upload":e.handleCheckImgLengthComplete}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("el-dialog",{attrs:{size:"tiny"},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),a("el-form-item",["已转送"===e.info.repairmentStatus||"维修中"===e.info.repairmentStatus?a("el-button",{directives:[{name:"permit",rawName:"v-permit",value:1102,expression:"1102"}],attrs:{type:"primary",size:"small"},on:{click:e.handleFinish}},[e._v("完成维修")]):"审核中"===e.info.repairmentStatus?a("el-button",{directives:[{name:"permit",rawName:"v-permit",value:1102,expression:"1102"}],attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("提交")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.handleCancel}},[e._v("返回")])],1)],1),e._v(" "),e._m(1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",data:e.info.operationRecordsList}},[a("el-table-column",{attrs:{prop:"event",label:"事件","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operation",label:"操作内容","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注信息","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operator",label:"操作人","min-width":"160"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operateDatetime",label:"操作时间","min-width":"150"}})],1),e._v(" "),a("el-dialog",{attrs:{size:"tiny"},model:{value:e.bigImgVisible,callback:function(t){e.bigImgVisible=t},expression:"bigImgVisible"}},[a("img",{attrs:{width:"100%",src:e.bigImageUrl,alt:""}})])],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contain-title"},[a("span",[e._v("维修审批")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contain-title"},[a("span",[e._v("操作记录")])])}]}},413:function(e,t,a){function r(e){a(1085)}var i=a(65)(a(925),a(1269),r,"data-v-7558eefa",null);e.exports=i.exports},925:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){var e=this,t=function(t,a,r){2===e.formData.chooseApproveType&&""===a?r(new Error("请输入维修员姓名")):r()};return{info:{repairmentType:"",repairmentArea:"",userName:"",userCellphone:"",contactPerson:"",contactPersonCellphone:"",description:"",repairmentDatetime:"",assess:"",repairmentStatus:"",repairMan:"",repairManCellphone:"",repairmentImgList:[],manageImgList:[],operationRecordsList:[],completeImgList:[]},approveType:[{value:2,label:"物业维修"},{value:1,label:"拒绝"},{value:3,label:"第三方维修"}],formData:{remark:"",chooseApproveType:"",repairMan:"",repairManCellphone:"",reportImgList:[],reportImgListComplete:[]},formRules:{remark:[{validator:function(e,t,a){""===t?a(new Error("请输入备注")):a()},trigger:"blur"}],chooseApproveType:[{validator:function(e,t,a){""===t?a(new Error("请选择审批方式")):a()},trigger:"blur"}],repairMan:[{validator:t,trigger:"blur"}]},dialogVisible:!1,dialogImageUrl:"",bigImgVisible:!1,bigImageUrl:"",tableData:[],repairManList:[]}},methods:{handleReportImgUpload:function(e,t,a){if(1e4!==e.code||1e4!==e.returnData.subCode)if("E0004"===e.code)this.$router.push("/manageSystem/login");else{this.$alert(e.message,"提示",{confirmButtonText:"确定"});for(var r=0;r<a.length;r++)if(a[r]===t){a.splice(r,1);break}}},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleReportImgChangeComplete:function(e,t){for(var a=[],r=0;r<t.length;r++)!0===Object.prototype.hasOwnProperty.call(t[r],"response")&&a.push(t[r].response.returnData.data.filePath);this.formData.reportImgListComplete=a},handleReportImgChange:function(e,t){for(var a=[],r=0;r<t.length;r++)!0===Object.prototype.hasOwnProperty.call(t[r],"response")&&a.push(t[r].response.returnData.data.filePath);this.formData.reportImgList=a},handleCheckImgLengthComplete:function(e){return!1===/(.(jpg|gif|jpeg|png))+$/i.test(e.name)?(this.$alert("请上传正确格式的图片","提示"),!1):this.$refs.complete.uploadFiles.length>6?(this.$alert("限上传六张图片","提示"),!1):void 0},handleCheckImgLength:function(e){return!1===/(.(jpg|gif|jpeg|png))+$/i.test(e.name)?(this.$alert("请上传正确格式的图片","提示"),!1):this.$refs.uploadImg.uploadFiles.length>1?(this.$alert("限上传一张图片","提示"),!1):void 0},handleSubmit:function(){var e=this;this.$refs.formData.validate(function(t){if(!t)return!1;e.$http({url:"/api/manageSystem/system/property/repairment/approveRepairment",method:"patch",data:{repairmentId:e.$route.query.repairmentId,approveType:e.formData.chooseApproveType,remark:e.formData.remark,repairMan:e.formData.repairMan,reportImgList:e.formData.reportImgList}}).then(function(t){"00000"===t.data.code&&(e.$message("审核成功"),e.$router.push("/manageSystem/property/repairment"))}).catch(function(e){console.log(e)})})},handleFinish:function(){var e=this;this.$http({url:"/api/manageSystem/system/property/repairment/finishRepairment",method:"patch",data:{repairmentId:this.$route.query.repairmentId,remark:this.formData.remark,finishImgList:this.formData.reportImgListComplete}}).then(function(t){"00000"===t.data.code&&(e.$message("审核成功"),e.$router.push("/manageSystem/property/repairment"))}).catch(function(e){console.log(e)})},handleCancel:function(){this.$router.push("/manageSystem/property/repairment")},handleBigImage:function(e){this.bigImageUrl=e,this.bigImgVisible=!0}},mounted:function(){var e=this;this.$http({url:"/api/manageSystem/system/property/repairment/getRepairmentInfo",params:{repairmentId:this.$route.query.repairmentId}}).then(function(t){"00000"===t.data.code&&(e.info=t.data.repairmentInfo)}).catch(function(e){console.log(e)}),this.$http({url:"/api/manageSystem/system/property/repairment/getRepairManList"}).then(function(t){"00000"===t.data.code&&(e.repairManList=t.data.repairManList)}).catch(function(e){console.log(e)})}}}});