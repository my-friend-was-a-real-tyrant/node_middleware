webpackJsonp([67],{1016:function(t,e){},1194:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"addquestionnaire"},[i("el-form",{staticClass:"demo-form-inline",attrs:{"label-width":"90px"}},[i("el-form-item",{attrs:{label:"标题："}},[i("el-input",{staticStyle:{width:"600px"},attrs:{size:"small",placeholder:""},model:{value:t.form.title,callback:function(e){t.form.title=e},expression:"form.title"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"内容："}},[i("el-input",{staticStyle:{width:"600px"},attrs:{type:"textarea",autosize:{minRows:2},placeholder:""},model:{value:t.form.content,callback:function(e){t.form.content=e},expression:"form.content"}})],1),t._v(" "),""===t.imgSrc?i("el-form-item",{attrs:{label:"封面图片："}},[i("el-upload",{ref:"uploadImg",staticClass:"editgoodsPic",attrs:{action:"/v1/file","list-type":"picture-card",name:"file",accept:"image/*",data:{uploadType:11,fileSuffixType:1},limit:1,"on-success":t.handleFileUpload,"on-preview":t.handlePictureCardPreview,"on-change":t.handleImgChange,"on-remove":t.handleImgChange,"before-upload":t.handleCheckImgLength}},[i("i",{staticClass:"el-icon-plus"})])],1):i("el-form-item",{attrs:{label:"封面图片："}},[i("div",{staticClass:"imgbox"},[i("img",{staticClass:"exitimg",attrs:{src:t.imgSrc,alt:""}}),t._v(" "),i("div",{staticClass:"mark"},[i("i",{staticClass:"el-icon-delete",on:{click:t.Delete}})])])]),t._v(" "),i("el-form-item",{attrs:{label:"前台地址："}},[i("el-input",{staticStyle:{width:"600px"},attrs:{size:"small",placeholder:""},model:{value:t.form.url,callback:function(e){t.form.url=e},expression:"form.url"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"针对版本："}},[i("el-select",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:""},model:{value:t.form.groupType,callback:function(e){t.form.groupType=e},expression:"form.groupType"}},[i("el-option",{attrs:{label:"住宅",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"办公楼",value:"2"}}),t._v(" "),i("el-option",{attrs:{label:"公寓楼",value:"3"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"结束时间："}},[i("el-date-picker",{staticStyle:{width:"180px"},attrs:{size:"small",type:"date",placeholder:"选择结束日期","picker-options":t.pickerOptions},model:{value:t.form.endDatetime,callback:function(e){t.form.endDatetime=e},expression:"form.endDatetime"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"问卷问题："}},[t._l(t.questionList,function(e,s){return i("div",{key:s,staticClass:"questioncontent"},[i("div",{staticClass:"title"},[i("span",[t._v("标题"+t._s(s+1)+"：")]),t._v(" "),i("el-input",{staticStyle:{width:"518px"},attrs:{size:"small"},model:{value:e.name,callback:function(t){e.name=t},expression:"item.name"}}),t._v(" "),0!==s&&"1"===t.type?i("el-button",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"10px"},attrs:{type:"danger",size:"small"},on:{click:function(e){t.AllDelete(s)}}},[t._v("删除")]):t._e()],1),t._v(" "),t._l(e.questionList,function(a,n){return i("div",{key:n,staticClass:"questionList"},[i("el-form",{ref:"item1",refInFor:!0,attrs:{model:t.form,"label-width":"90px"}},[i("el-form-item",{attrs:{label:"问题"+(n+1)+"："}},[i("el-input",{staticStyle:{width:"480px"},attrs:{size:"small"},model:{value:a.question,callback:function(t){a.question=t},expression:"item1.question"}}),t._v(" "),n===e.questionList.length-1&&"1"==t.type?i("el-button",{staticClass:"el-icon-plus",staticStyle:{"margin-left":"10px"},attrs:{type:"success",size:"small"},on:{click:function(e){t.AddOneQuestion(s)}}},[t._v("添加")]):t._e(),t._v(" "),0!==n&&"1"==t.type?i("el-button",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"10px"},attrs:{type:"warning",size:"small"},on:{click:function(e){t.DeleteOneQuestion(s,n)}}},[t._v("删除")]):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"类型："}},[i("el-select",{staticStyle:{width:"480px"},attrs:{size:"small",placeholder:""},model:{value:a.type,callback:function(t){a.type=t},expression:"item1.type"}},[i("el-option",{attrs:{label:"单选题",value:1}}),t._v(" "),i("el-option",{attrs:{label:"多选题",value:2}}),t._v(" "),i("el-option",{attrs:{label:"填空题",value:3}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"是否必填："}},[i("el-select",{staticStyle:{width:"480px"},attrs:{size:"small",placeholder:""},model:{value:a.isMust,callback:function(t){a.isMust=t},expression:"item1.isMust"}},[i("el-option",{attrs:{label:"是",value:1}}),t._v(" "),i("el-option",{attrs:{label:"否",value:2}})],1)],1),t._v(" "),3!=a.type&&"1"==t.type?i("el-form-item",{attrs:{label:"选项："}},[i("el-input",{staticStyle:{width:"480px"},attrs:{size:"small"},model:{value:a.options,callback:function(t){a.options=t},expression:"item1.options"}}),t._v(" "),i("span",{staticStyle:{color:"red"}},[t._v("请注意如果该问题有多个选项中间用中文顿号分开!!!")])],1):t._e(),t._v(" "),t._l(a.optionsList,function(e,s){return"2"==t.type?i("el-form-item",{key:s,attrs:{label:"选项："}},[i("el-input",{staticStyle:{width:"480px"},attrs:{size:"small"},model:{value:e.answerOptions,callback:function(t){e.answerOptions=t},expression:"item2.answerOptions"}})],1):t._e()})],2)],1)})],2)}),t._v(" "),"1"==t.type?i("el-button",{staticClass:"el-icon-plus",attrs:{type:"success",size:"small"},on:{click:t.AddOneType}},[t._v("添加")]):t._e()],2)],1),t._v(" "),i("el-button",{staticStyle:{"margin-left":"350px"},attrs:{type:"primary"},on:{click:t.Submit}},[t._v(t._s("1"==t.type?"提交问卷":"保存问卷"))]),t._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:t.BackToList}},[t._v("问卷列表")]),t._v(" "),i("el-dialog",{attrs:{size:"tiny"},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[i("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]}},408:function(t,e,i){function s(t){i(1016)}var a=i(65)(i(920),i(1194),s,"data-v-1707659e",null);t.exports=a.exports},795:function(t,e,i){t.exports={default:i(796),__esModule:!0}},796:function(t,e,i){var s=i(32),a=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}},920:function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(36),n=s(a),o=i(795),l=s(o);e.default={data:function(){return{pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()}},form:{title:"",content:"",image:"",url:"",groupType:"",endDatetime:"",sortList:"",type:1},questionList:[{name:"",number:1,questionList:[{number:1,question:"",type:"",isMust:1,options:""}]}],imgList:[],dialogVisible:!1,dialogImageUrl:"",imgSrc:""}},computed:{type:function(){return this.$route.query.type}},watch:{imgList:function(t,e){var i=document.getElementsByClassName("el-upload--picture-card");t.length>=1?i[0].style.display="none":i[0].style.display="block"}},mounted:function(){this.$route.query.id&&"2"==this.$route.query.type&&this.Get()},methods:{AllDelete:function(t){this.questionList.splice(t,1)},AddOneType:function(){var t=this.questionList.length;this.questionList.push({name:"",number:t+1,questionList:[{number:1,question:"",type:"",isMust:1,options:""}]})},AddOneQuestion:function(t){var e=this.questionList[t].questionList.length;this.questionList[t].questionList.push({number:e+1,question:"",type:"",isMust:1,options:""})},DeleteOneQuestion:function(t,e){this.questionList[t].questionList.splice(e,1)},Submit:function(){var t=this;if("1"==this.$route.query.type){if(""===this.form.title)return this.zdMessage("warning","请输入正确的标题");if(""===this.form.content)return this.zdMessage("warning","请输入正确的内容");if(""===this.form.image)return this.zdMessage("warning","请上传封面图片");if(""===this.form.url)return this.zdMessage("warning","请输入正确的地址");if(""===this.form.groupType)return this.zdMessage("warning","请选择版本");if(""===this.form.endDatetime)return this.zdMessage("warning","请选择结束时间");this.form.endDatetime=this.ParseTime(Date.parse(this.form.endDatetime)+8634e4),this.form.sortList=(0,l.default)(this.handleData((0,l.default)(this.questionList))),this.handleData((0,l.default)(this.questionList))&&this.$http({url:"/api/manageSystem/system/property/questionnaire/addQuestionnaire",method:"post",data:this.form}).then(function(e){"00000"===e.data.code&&(t.$message({type:"success",message:"添加成功"}),setTimeout(function(){t.$router.push({path:"/manageSystem/property/questionnaire"})},1500))}).catch(function(t){})}else if("2"==this.$route.query.type){""===this.imgSrc?this.form.image=this.imgList[0]:(this.form.image=this.imgSrc.replace("http://system-test.zhongdapuhui.com",""),this.form.image=this.imgSrc.replace("http://system.zhongdapuhui.com","")),this.form.createDatetime=this.form.endDate,delete this.form.endDate,delete this.form.isShow,delete this.form.createDatetime;for(var e=0;e<this.questionList.length;e++)for(var i=this.questionList[e],s=0;s<i.questionList.length;s++){var a=i.questionList[s];a.options=a.optionsList}this.form.type=1,this.form.sortList=(0,l.default)(this.questionList),this.$http({url:"/api/manageSystem/system/property/questionnaire/editQuestionnaire",method:"patch",data:this.form}).then(function(e){"00000"===e.data.code&&(t.$message({type:"success",message:"保存成功"}),setTimeout(function(){t.$router.push({path:"/manageSystem/property/questionnaire"})},1500))}).catch(function(t){})}},handleData:function(t){t=JSON.parse(t);for(var e=0;e<t.length;e++){var i=t[e];if(""===i.name)return this.zdMessage("warning","请仔细检查所有的问卷问题");for(var s=0;s<i.questionList.length;s++){var a=i.questionList[s];for(var n in a)if(a.hasOwnProperty(n)){var o=a[n];if(""==o){if(3!=a.type)return this.zdMessage("warning","请仔细检查所有的问卷问题");if("options"!=n)return this.zdMessage("warning","请仔细检查所有的问卷问题");a.options=[]}else a.options.indexOf("、")>0&&(a.options=a.options.split("、"))}}}return t},handleFileUpload:function(t,e,i){if(1e4!==t.code||1e4!==t.returnData.subCode)if("E0004"===t.code)this.$router.push("/manageSystem/login");else{this.$alert(t.message,"提示",{confirmButtonText:"确定"});for(var s=0;s<i.length;s++)if(i[s]===e){i.splice(s,1);break}}},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleDetailImgChange:function(t,e){this.detailImg="";for(var i=0;i<e.length;i++)if(!0===Object.prototype.hasOwnProperty.call(e[i],"response")){this.detailImg=e[i].response.returnData.data.filePath;break}},handleImgChange:function(t,e){for(var i=[],s=0;s<e.length;s++)!0===Object.prototype.hasOwnProperty.call(e[s],"response")&&i.push(e[s].response.returnData.data.filePath);this.imgList=i,this.form.image=this.imgList[0]},handleClearBeforeDetailImg:function(t){if(!1===/(.(jpg|gif|jpeg|png))+$/i.test(t.name))return this.$alert("请上传正确格式的图片","提示"),!1;this.$refs.uploadDetailImg.uploadFiles.length>1&&this.$refs.uploadDetailImg.handleRemove(this.$refs.uploadDetailImg.uploadFiles[0])},handleCheckImgLength:function(t){return!1===/(.(jpg|gif|jpeg|png))+$/i.test(t.name)?(this.$alert("请上传正确格式的图片","提示"),!1):this.$refs.uploadImg.uploadFiles.length>6?(this.$alert("限上传六张图片","提示"),!1):void 0},BackToList:function(){this.$router.push({path:"/manageSystem/property/questionnaire"})},zdMessage:function(t,e){this.$message({type:t,message:e,center:!0,duration:2e3})},ParseTime:function(t,e){if(0===arguments.length)return null;var i=e||"{y}-{m}-{d} {h}:{i}:{s}",s=void 0;"object"===(void 0===t?"undefined":(0,n.default)(t))?s=t:(10===(""+t).length&&(t=1e3*parseInt(t)),s=new Date(t));var a={y:s.getFullYear(),m:s.getMonth()+1,d:s.getDate(),h:s.getHours(),i:s.getMinutes(),s:s.getSeconds(),a:s.getDay()};return i.replace(/{(y|m|d|h|i|s|a)+}/g,function(t,e){0==a.a&&(a.a=7);var i=a[e];return"a"===e?["星期一","星期二","星期三","星期四","星期五","星期六","星期日"][i-1]:(t.length>0&&i<10&&(i="0"+i),i||0)})},Delete:function(){this.imgSrc=""},Get:function(){var t=this;this.$http({url:"/api/manageSystem/system/property/questionnaire/getQuestionnaireInfo",params:{id:this.$route.query.id}}).then(function(e){if("00000"===e.data.code){var i=e.data;i.questionnaireInfo.endDate=i.questionnaireInfo.endDatetime,t.form=i.questionnaireInfo,"住宅"===t.form.groupType?t.form.groupType="1":"写字楼"===t.form.groupType||t.form.groupType,t.imgSrc=i.questionnaireInfo.image,t.questionList=i.questionnaireInfo.sortList}}).catch(function(t){})}}}}});